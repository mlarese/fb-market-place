{
    "name": "Quofind - 3. Periodic Matching",
    "flow": [
        {
            "id": 1,
            "module": "builtin:BasicScheduler",
            "version": 1,
            "parameters": {"interval": 5},
            "mapper": {},
            "metadata": {
                "designer": {
                    "x": 0,
                    "y": 0,
                    "notes": {
                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nSCHEDULER: OGNI 5 MINUTI\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nEsegue il matching periodico tra request attive e nuovi listing.\n\n‚è∞ CONFIGURAZIONE:\n‚Ä¢ Intervallo: 5 minuti\n‚Ä¢ Time restrictions (opzionale):\n  - Time from: 08:00\n  - Time to: 23:00\n  - Days: Lun-Dom\n\nüí° PERCH√â 5 MINUTI:\n‚Ä¢ Bilancio tra reattivit√† e costi\n‚Ä¢ ~288 esecuzioni/giorno\n‚Ä¢ ~8640 esecuzioni/mese\n\nüìä COSTI MAKE:\n‚Ä¢ Free tier: 1000 ops/mese (insufficiente)\n‚Ä¢ Core: 10000 ops/mese (~$9/mese)\n‚Ä¢ Pro: 40000 ops/mese (~$16/mese) ‚úì consigliato",
                        "position": "bottom"
                    }
                }
            }
        },
        {
            "id": 2,
            "module": "http:ActionSendData",
            "version": 3,
            "parameters": {},
            "mapper": {
                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/requests/active",
                "method": "GET",
                "headers": [],
                "parseResponse": true
            },
            "metadata": {
                "designer": {
                    "x": 300,
                    "y": 0,
                    "notes": {
                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nRECUPERA REQUEST ATTIVE\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nüîó ENDPOINT: GET /requests/active\n\nRestituisce tutte le request non scadute e non soddisfatte.\n\nüì• RISPOSTA:\n{\n  \"data\": [\n    {\n      \"id\": \"req_123\",\n      \"userId\": \"fb_user_id\",\n      \"keywords\": [\"iphone\", \"13\"],\n      \"category\": \"elettronica\",\n      \"maxPrice\": 600,\n      \"location\": \"Milano\",\n      \"notifiedListings\": [\"lst_1\", \"lst_2\"],\n      \"createdAt\": \"2024-01-15T...\",\n      \"expiresAt\": \"2024-01-22T...\"\n    },\n    ...\n  ],\n  \"count\": 25\n}\n\nüîó VARIABILI:\n‚Ä¢ {{2.data}} ‚Üí Array di request\n‚Ä¢ {{2.data.count}} ‚Üí Numero totale",
                        "position": "bottom"
                    }
                }
            }
        },
        {
            "id": 3,
            "module": "builtin:BasicRouter",
            "version": 1,
            "parameters": {"else": 0},
            "mapper": null,
            "metadata": {
                "designer": {
                    "x": 600,
                    "y": 0,
                    "notes": {
                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nROUTER: CI SONO REQUEST?\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚Üí ROUTE 1: S√¨, procedi con matching\n   Filtro: count > 0\n\n‚Üí ROUTE 2: No, termina\n   (else - nessuna azione)\n\nüí° Se non ci sono request attive, lo scenario termina qui per risparmiare operazioni.",
                        "position": "bottom"
                    }
                }
            },
            "routes": [
                {
                    "flow": [
                        {
                            "id": 4,
                            "module": "builtin:BasicIterator",
                            "version": 1,
                            "parameters": {},
                            "mapper": {"array": "{{2.data}}"},
                            "metadata": {
                                "designer": {
                                    "x": 900,
                                    "y": 0,
                                    "notes": {
                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nITERATOR: PER OGNI REQUEST\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nItera su ogni request attiva per cercare match.\n\nüì¶ VARIABILI PER ITERAZIONE:\n‚Ä¢ {{4.id}} ‚Üí ID request\n‚Ä¢ {{4.userId}} ‚Üí User ID\n‚Ä¢ {{4.keywords}} ‚Üí Keywords ricerca\n‚Ä¢ {{4.category}} ‚Üí Categoria\n‚Ä¢ {{4.maxPrice}} ‚Üí Budget max\n‚Ä¢ {{4.location}} ‚Üí Localit√†\n‚Ä¢ {{4.notifiedListings}} ‚Üí Gi√† notificati\n\n‚ö†Ô∏è ATTENZIONE:\nSe ci sono molte request, questo pu√≤ generare molte operazioni.\nConsiglio: Limitare a 50-100 request per esecuzione.",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "filter": {
                                "name": "Has Active Requests",
                                "conditions": [[{"a": "{{2.data.count}}", "b": "0", "o": "number:gt"}]]
                            }
                        },
                        {
                            "id": 5,
                            "module": "http:ActionSendData",
                            "version": 3,
                            "parameters": {},
                            "mapper": {
                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings?q={{join(4.keywords; \",\")}}&category={{4.category}}&maxPrice={{4.maxPrice}}&location={{4.location}}&status=active&limit=20",
                                "method": "GET",
                                "headers": [],
                                "parseResponse": true
                            },
                            "metadata": {
                                "designer": {
                                    "x": 1200,
                                    "y": 0,
                                    "notes": {
                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nCERCA LISTING CORRISPONDENTI\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nüîó ENDPOINT: GET /listings\n\nüì§ PARAMETRI:\n‚Ä¢ q: keywords (comma-separated)\n‚Ä¢ category: categoria\n‚Ä¢ maxPrice: budget massimo\n‚Ä¢ location: localit√†\n‚Ä¢ status: active\n‚Ä¢ limit: 20 (max risultati)\n\nüì• RISPOSTA:\n‚Ä¢ {{5.data}} ‚Üí Array listing\n‚Ä¢ {{5.data.count}} ‚Üí Numero match\n\nüí° La Lambda usa OpenSearch per ricerca full-text con scoring di rilevanza.",
                                        "position": "bottom"
                                    }
                                }
                            }
                        },
                        {
                            "id": 6,
                            "module": "util:FunctionFilter",
                            "version": 1,
                            "parameters": {},
                            "mapper": {
                                "array": "{{5.data}}",
                                "condition": "{{!contains(4.notifiedListings; item.id)}}"
                            },
                            "metadata": {
                                "designer": {
                                    "x": 1500,
                                    "y": 0,
                                    "notes": {
                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nFILTRA GI√Ä NOTIFICATI\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nRimuove i listing gi√† notificati per questa request.\n\nüì• INPUT: {{5.data}} (tutti i match)\nüì§ OUTPUT: {{6}} (solo nuovi match)\n\nüí° LOGICA:\ncontains(4.notifiedListings, item.id) = true ‚Üí gi√† notificato ‚Üí escludi\ncontains(4.notifiedListings, item.id) = false ‚Üí nuovo ‚Üí includi\n\n‚ö†Ô∏è Questo evita di notificare pi√π volte lo stesso listing.",
                                        "position": "bottom"
                                    }
                                }
                            }
                        },
                        {
                            "id": 7,
                            "module": "builtin:BasicRouter",
                            "version": 1,
                            "parameters": {"else": 0},
                            "mapper": null,
                            "metadata": {
                                "designer": {
                                    "x": 1800,
                                    "y": 0,
                                    "notes": {
                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nROUTER: NUOVI MATCH?\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n‚Üí ROUTE 1: S√¨, notifica\n   Filtro: length(filteredArray) > 0\n\n‚Üí ROUTE 2: No, skip\n   (nessuna notifica necessaria)",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "routes": [
                                {
                                    "flow": [
                                        {
                                            "id": 8,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{4.userId}}\"},\"messaging_type\":\"MESSAGE_TAG\",\"tag\":\"CONFIRMED_EVENT_UPDATE\",\"message\":{\"text\":\"üîî Buone notizie!\\n\\nHo trovato {{length(6)}} nuovi annunci per la tua ricerca:\\n\\\"{{join(4.keywords; \\\", \\\")}}\\\"\\n\\nEccoli:\"}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 2100,
                                                    "y": -100,
                                                    "notes": {
                                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nNOTIFICA BUYER: INTRO\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nInvia messaggio introduttivo al buyer.\n\n‚ö†Ô∏è MESSAGE_TAG: CONFIRMED_EVENT_UPDATE\nPermette di inviare fuori dalla finestra 24h.\n\nüì§ MESSAGGIO:\n\"üîî Buone notizie!\nHo trovato X nuovi annunci per la tua ricerca:\"",
                                                        "position": "bottom"
                                                    }
                                                }
                                            },
                                            "filter": {
                                                "name": "Has New Matches",
                                                "conditions": [[{"a": "{{length(6)}}", "b": "0", "o": "number:gt"}]]
                                            }
                                        },
                                        {
                                            "id": 9,
                                            "module": "builtin:Sleep",
                                            "version": 1,
                                            "parameters": {},
                                            "mapper": {"delay": "500"},
                                            "metadata": {
                                                "designer": {
                                                    "x": 2400,
                                                    "y": -100,
                                                    "notes": {
                                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nPAUSA 500ms\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nEvita rate limiting di Facebook Messenger.\n\nüí° Facebook limita a ~200 messaggi/secondo.\nCon la pausa evitiamo errori 429.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 10,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{4.userId}}\"},\"messaging_type\":\"MESSAGE_TAG\",\"tag\":\"CONFIRMED_EVENT_UPDATE\",\"message\":{\"attachment\":{\"type\":\"template\",\"payload\":{\"template_type\":\"generic\",\"elements\":{{6.carouselElements}}}}}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 2700,
                                                    "y": -100,
                                                    "notes": {
                                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nNOTIFICA BUYER: CAROUSEL\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nInvia carousel con i nuovi match.\n\nüì§ FORMATO ELEMENTO:\n{\n  \"title\": \"iPhone 13 Pro\",\n  \"subtitle\": \"650‚Ç¨ - Milano\",\n  \"image_url\": \"https://...\",\n  \"buttons\": [\n    {\"type\": \"postback\", \"title\": \"üëÄ Dettagli\", \"payload\": \"DETAILS_lst_123\"},\n    {\"type\": \"postback\", \"title\": \"üì© Contatta\", \"payload\": \"CONTACT_lst_123\"}\n  ]\n}\n\nüí° {{6.carouselElements}} deve essere formattato dalla Lambda o da un modulo precedente.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 11,
                                            "module": "builtin:BasicIterator",
                                            "version": 1,
                                            "parameters": {},
                                            "mapper": {"array": "{{6}}"},
                                            "metadata": {
                                                "designer": {
                                                    "x": 3000,
                                                    "y": -100,
                                                    "notes": {
                                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nITERATOR: PER OGNI MATCH\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nItera sui nuovi match per notificare i seller.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 12,
                                            "module": "builtin:Sleep",
                                            "version": 1,
                                            "parameters": {},
                                            "mapper": {"delay": "300"},
                                            "metadata": {"designer": {"x": 3300, "y": -100, "notes": {"text": "Pausa rate limiting", "position": "bottom"}}}
                                        },
                                        {
                                            "id": 13,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{11.userId}}\"},\"messaging_type\":\"MESSAGE_TAG\",\"tag\":\"CONFIRMED_EVENT_UPDATE\",\"message\":{\"text\":\"üì£ Qualcuno cerca il tuo prodotto!\\n\\nüì¶ {{11.title}}\\nüîç Ricerca: \\\"{{join(4.keywords; \\\", \\\")}}\\\"\\n\\nVuoi essere contattato?\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"‚úÖ S√¨\",\"payload\":\"ACCEPT_MATCH_{{4.id}}_{{11.id}}\"},{\"content_type\":\"text\",\"title\":\"‚ùå No\",\"payload\":\"DECLINE_MATCH\"}]}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 3600,
                                                    "y": -100,
                                                    "notes": {
                                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nNOTIFICA SELLER\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nInforma il venditore che qualcuno cerca il suo prodotto.\n\nüì§ MESSAGGIO:\n\"üì£ Qualcuno cerca il tuo prodotto!\n[Titolo]\nRicerca: [keywords]\"\n\nüîò QUICK REPLIES:\n‚Ä¢ ‚úÖ S√¨ ‚Üí ACCEPT_MATCH_[reqId]_[listingId]\n‚Ä¢ ‚ùå No ‚Üí DECLINE_MATCH\n\nüí° Se accetta, lo Scenario 2 metter√† in contatto buyer e seller.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 14,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/requests/{{4.id}}",
                                                "method": "PATCH",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"notifiedListings\": {{add(4.notifiedListings; map(6; \"id\"))}}, \"lastMatchedAt\": \"{{now}}\"}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 3900,
                                                    "y": -100,
                                                    "notes": {
                                                        "text": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nAGGIORNA REQUEST\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nAggiunge i listing notificati alla lista per evitare duplicati.\n\nüîó ENDPOINT: PATCH /requests/{id}\n\nüì§ BODY:\n‚Ä¢ notifiedListings: array aggiornato\n‚Ä¢ lastMatchedAt: timestamp ultimo match\n\nüí° Alla prossima esecuzione, questi listing saranno filtrati.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ],
    "metadata": {
        "version": 1,
        "scenario": {
            "roundtrips": 1,
            "maxErrors": 3,
            "autoCommit": true,
            "autoCommitTriggerLast": true,
            "sequential": false
        },
        "designer": {"orphans": []},
        "notes": "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\nSCENARIO 3: PERIODIC MATCHING\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\nüìã DESCRIZIONE:\nEsegue il matching automatico tra request di acquisto e listing di vendita ogni 5 minuti.\n\nüîÑ FLUSSO:\n\n1. SCHEDULER trigger ogni 5 minuti\n   ‚Üì\n2. GET /requests/active ‚Üí Lista request\n   ‚Üì\n3. Se count > 0 ‚Üí Itera su ogni request\n   ‚Üì\n4. Per ogni request:\n   a. GET /listings con keywords/category/price/location\n   b. Filtra gi√† notificati\n   c. Se nuovi match:\n      - Notifica BUYER con carousel\n      - Notifica ogni SELLER\n      - Aggiorna request con listing notificati\n\n‚öôÔ∏è CONFIGURAZIONI:\n‚Ä¢ YOUR_PAGE_ACCESS_TOKEN (Messenger)\n‚Ä¢ Intervallo scheduler: 5 minuti\n‚Ä¢ Time restrictions: 08:00-23:00 (opzionale)\n\nüìä OPERAZIONI STIMATE:\n‚Ä¢ 0 request: ~2 ops\n‚Ä¢ 10 request, 3 match ciascuna: ~100 ops\n‚Ä¢ Formula: 2 + (N_requests √ó (3 + N_new_matches √ó 3))\n\nüí∞ COSTI:\n‚Ä¢ ~8640 esecuzioni/mese (ogni 5 min)\n‚Ä¢ Se media 5 ops/esecuzione: ~43200 ops/mese\n‚Ä¢ Piano Pro Make consigliato\n\nüîó ENDPOINT AWS:\n‚Ä¢ GET /requests/active\n‚Ä¢ GET /listings (search)\n‚Ä¢ PATCH /requests/{id}\n\n‚ö†Ô∏è OTTIMIZZAZIONI:\n‚Ä¢ Sleep tra messaggi per rate limiting\n‚Ä¢ Limita request per esecuzione se troppe\n‚Ä¢ Considera batch notifications"
    }
}
