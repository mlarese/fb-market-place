{
    "name": "Quofind - 2. Messenger Handler",
    "flow": [
        {
            "id": 1,
            "module": "gateway:CustomWebHook",
            "version": 1,
            "parameters": {"hook": null, "maxResults": 1},
            "mapper": {},
            "metadata": {
                "designer": {
                    "x": 0,
                    "y": 0,
                    "notes": {
                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nWEBHOOK: FACEBOOK MESSENGER EVENTS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nRiceve messaggi e interazioni da Messenger.\n\nğŸ“¥ TIPI DI EVENTI:\nâ€¢ message â†’ Messaggio testuale\nâ€¢ postback â†’ Click su pulsante/quick reply\nâ€¢ referral â†’ Click su link m.me\n\nâš™ï¸ CONFIGURAZIONE FACEBOOK:\n1. Webhooks â†’ Page â†’ Subscribe\n2. Fields: messages, messaging_postbacks\n3. Callback URL: questo webhook\n4. Verify Token: quofind_make_2024\n\nğŸ“¦ STRUTTURA DATI:\n{\n  \"object\": \"page\",\n  \"entry\": [{\n    \"messaging\": [{\n      \"sender\": {\"id\": \"USER_ID\"},\n      \"recipient\": {\"id\": \"PAGE_ID\"},\n      \"timestamp\": 1234567890,\n      \"message\": {\n        \"mid\": \"msg_id\",\n        \"text\": \"Testo messaggio\"\n      },\n      \"postback\": {\n        \"payload\": \"PAYLOAD_STRING\",\n        \"title\": \"Testo pulsante\"\n      }\n    }]\n  }]\n}\n\nğŸ”— VARIABILI:\nâ€¢ {{1.entry[].messaging[].sender.id}} â†’ User ID\nâ€¢ {{1.entry[].messaging[].message.text}} â†’ Testo\nâ€¢ {{1.entry[].messaging[].postback.payload}} â†’ Payload",
                        "position": "bottom"
                    }
                },
                "expect": [
                    {"name": "object", "type": "text"},
                    {
                        "name": "entry",
                        "type": "array",
                        "spec": [{
                            "name": "messaging",
                            "type": "array",
                            "spec": [
                                {"name": "sender", "type": "collection", "spec": [{"name": "id", "type": "text"}]},
                                {"name": "recipient", "type": "collection", "spec": [{"name": "id", "type": "text"}]},
                                {"name": "timestamp", "type": "number"},
                                {"name": "message", "type": "collection", "spec": [{"name": "mid", "type": "text"}, {"name": "text", "type": "text"}]},
                                {"name": "postback", "type": "collection", "spec": [{"name": "payload", "type": "text"}, {"name": "title", "type": "text"}]}
                            ]
                        }]
                    }
                ]
            }
        },
        {
            "id": 2,
            "module": "builtin:BasicRouter",
            "version": 1,
            "parameters": {"else": 1},
            "mapper": null,
            "metadata": {
                "designer": {
                    "x": 300,
                    "y": 0,
                    "notes": {
                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nROUTER: TIPO MESSAGGIO\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ”€ ROUTES:\n\nâ†’ ROUTE 1: POSTBACK (pulsante cliccato)\n  Filtro: postback.payload esiste\n  â†’ Sub-router per tipo payload\n\nâ†’ ROUTE 2: MESSAGGIO TESTUALE\n  Filtro: message.text esiste\n  â†’ Gemini per intent detection\n\nğŸ’¡ ELSE: Route 2 (default per messaggi)",
                        "position": "bottom"
                    }
                }
            },
            "routes": [
                {
                    "flow": [
                        {
                            "id": 3,
                            "module": "builtin:BasicRouter",
                            "version": 1,
                            "parameters": {"else": 0},
                            "mapper": null,
                            "metadata": {
                                "designer": {
                                    "x": 600,
                                    "y": -400,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nROUTER: PAYLOAD POSTBACK\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nSmista in base al payload del pulsante cliccato.\n\nğŸ”€ PAYLOADS GESTITI:\n\nâ†’ CONFIRM_LISTING_* â†’ Conferma listing\nâ†’ CONFIRM_REQUEST_* â†’ Conferma request\nâ†’ SOLD_* â†’ Registra vendita\nâ†’ CONTACT_* â†’ Contatta venditore\nâ†’ MY_LISTINGS â†’ Mostra annunci utente\nâ†’ MY_REQUESTS â†’ Mostra ricerche utente\nâ†’ BALANCE â†’ Saldo cashback\nâ†’ TRANSACTIONS â†’ Storico transazioni\nâ†’ HELP â†’ Menu aiuto\nâ†’ SEARCH â†’ Avvia ricerca",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "filter": {
                                "name": "Is Postback",
                                "conditions": [[{"a": "{{1.entry[].messaging[].postback.payload}}", "b": "", "o": "text:notequal"}]]
                            },
                            "routes": [
                                {
                                    "flow": [
                                        {
                                            "id": 4,
                                            "module": "util:SetVariables",
                                            "version": 1,
                                            "parameters": {},
                                            "mapper": {
                                                "variables": [
                                                    {"name": "postId", "value": "{{replace(1.entry[].messaging[].postback.payload; \"CONFIRM_LISTING_\"; \"\")}}"}
                                                ]
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 900,
                                                    "y": -600,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nESTRAI POST ID\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nEstrae l'ID del post dal payload.\n\nInput: CONFIRM_LISTING_123_456\nOutput: {{4.postId}} = 123_456",
                                                        "position": "bottom"
                                                    }
                                                }
                                            },
                                            "filter": {
                                                "name": "CONFIRM_LISTING_*",
                                                "conditions": [[{"a": "{{1.entry[].messaging[].postback.payload}}", "b": "CONFIRM_LISTING_", "o": "text:startswith"}]]
                                            }
                                        },
                                        {
                                            "id": 5,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings/confirm-from-post",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"facebookPostId\": \"{{4.postId}}\", \"userId\": \"{{1.entry[].messaging[].sender.id}}\", \"confirmedType\": \"listing\"}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1200,
                                                    "y": -600,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nCONFERMA LISTING DA POST\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nL'utente ha confermato che il post Ã¨ un annuncio di vendita.\n\nCrea il listing con i dati giÃ  analizzati (salvati temporaneamente).",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 6,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"âœ… Perfetto! Ho creato il tuo annuncio.\\n\\nID: {{5.data.id}}\\n\\nSarÃ  visibile per 30 giorni.\"}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {"x": 1500, "y": -600, "notes": {"text": "CONFERMA: Listing creato", "position": "bottom"}}
                                            }
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 7,
                                            "module": "util:SetVariables",
                                            "version": 1,
                                            "parameters": {},
                                            "mapper": {"variables": [{"name": "postId", "value": "{{replace(1.entry[].messaging[].postback.payload; \"SOLD_\"; \"\")}}"}]},
                                            "metadata": {"designer": {"x": 900, "y": -400, "notes": {"text": "Estrae post ID da SOLD_*", "position": "bottom"}}},
                                            "filter": {
                                                "name": "SOLD_*",
                                                "conditions": [[{"a": "{{1.entry[].messaging[].postback.payload}}", "b": "SOLD_", "o": "text:startswith"}]]
                                            }
                                        },
                                        {
                                            "id": 8,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ’° Ottimo, hai venduto!\\n\\nA quanto hai venduto l'oggetto? Rispondi con il prezzo (es: \\\"350â‚¬\\\") per calcolare il cashback.\"}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1200,
                                                    "y": -400,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nCHIEDI PREZZO VENDITA\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nL'utente ha indicato di aver venduto.\nOra chiediamo il prezzo effettivo per calcolare il cashback.\n\nLa risposta verrÃ  processata come messaggio testuale e Gemini estrarrÃ  il prezzo.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 9,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/users/{{1.entry[].messaging[].sender.id}}/context",
                                                "method": "PUT",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"awaitingInput\": \"sale_price\", \"contextData\": {\"postId\": \"{{7.postId}}\"}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1500,
                                                    "y": -400,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nSALVA CONTESTO CONVERSAZIONE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nSalva che stiamo aspettando il prezzo di vendita.\n\nQuando l'utente risponde con un numero, sapremo che Ã¨ il prezzo.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 10,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/cashback/balance?userId={{1.entry[].messaging[].sender.id}}",
                                                "method": "GET",
                                                "headers": [],
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 900,
                                                    "y": -200,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nRECUPERA SALDO CASHBACK\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nChiama API per ottenere saldo utente.\n\nğŸ“¥ RISPOSTA:\n{\n  \"available\": 25.50,\n  \"pending\": 12.00,\n  \"total\": 37.50,\n  \"currency\": \"EUR\"\n}",
                                                        "position": "bottom"
                                                    }
                                                }
                                            },
                                            "filter": {
                                                "name": "BALANCE",
                                                "conditions": [[{"a": "{{1.entry[].messaging[].postback.payload}}", "b": "BALANCE", "o": "text:equal"}]]
                                            }
                                        },
                                        {
                                            "id": 11,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ’° Il tuo saldo Quofind Cashback:\\n\\nâœ… Disponibile: {{10.data.available}}â‚¬\\nâ³ In attesa: {{10.data.pending}}â‚¬\\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\nğŸ“Š Totale: {{10.data.total}}â‚¬\\n\\nIl cashback in attesa diventa disponibile 30 giorni dopo la vendita.\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"ğŸ“œ Storico\",\"payload\":\"TRANSACTIONS\"},{\"content_type\":\"text\",\"title\":\"ğŸ’¸ Prelievo\",\"payload\":\"WITHDRAW\"},{\"content_type\":\"text\",\"title\":\"ğŸ  Menu\",\"payload\":\"HELP\"}]}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {"x": 1200, "y": -200, "notes": {"text": "MOSTRA SALDO con opzioni", "position": "bottom"}}
                                            }
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 12,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/cashback/transactions?userId={{1.entry[].messaging[].sender.id}}&limit=10",
                                                "method": "GET",
                                                "headers": [],
                                                "parseResponse": true
                                            },
                                            "metadata": {"designer": {"x": 900, "y": 0, "notes": {"text": "Recupera ultime 10 transazioni", "position": "bottom"}}},
                                            "filter": {
                                                "name": "TRANSACTIONS",
                                                "conditions": [[{"a": "{{1.entry[].messaging[].postback.payload}}", "b": "TRANSACTIONS", "o": "text:equal"}]]
                                            }
                                        },
                                        {
                                            "id": 13,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ“œ Ultime transazioni:\\n\\n{{12.data.formatted}}\\n\\nTotale guadagnato: {{12.data.totalEarned}}â‚¬\"}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {"designer": {"x": 1200, "y": 0, "notes": {"text": "Mostra storico formattato", "position": "bottom"}}}
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 14,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings?userId={{1.entry[].messaging[].sender.id}}&status=active",
                                                "method": "GET",
                                                "headers": [],
                                                "parseResponse": true
                                            },
                                            "metadata": {"designer": {"x": 900, "y": 200, "notes": {"text": "Recupera annunci attivi utente", "position": "bottom"}}},
                                            "filter": {
                                                "name": "MY_LISTINGS",
                                                "conditions": [[{"a": "{{1.entry[].messaging[].postback.payload}}", "b": "MY_LISTINGS", "o": "text:equal"}]]
                                            }
                                        },
                                        {
                                            "id": 15,
                                            "module": "builtin:BasicRouter",
                                            "version": 1,
                                            "parameters": {"else": 1},
                                            "mapper": null,
                                            "metadata": {"designer": {"x": 1200, "y": 200, "notes": {"text": "Ha annunci?", "position": "bottom"}}},
                                            "routes": [
                                                {
                                                    "flow": [
                                                        {
                                                            "id": 16,
                                                            "module": "http:ActionSendData",
                                                            "version": 3,
                                                            "parameters": {},
                                                            "mapper": {
                                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                                "method": "POST",
                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                "bodyType": "raw",
                                                                "contentType": "application/json",
                                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"attachment\":{\"type\":\"template\",\"payload\":{\"template_type\":\"generic\",\"elements\":{{14.data.carouselElements}}}}}}",
                                                                "parseResponse": true
                                                            },
                                                            "metadata": {"designer": {"x": 1500, "y": 150, "notes": {"text": "Carousel annunci", "position": "bottom"}}},
                                                            "filter": {"name": "Has Listings", "conditions": [[{"a": "{{14.data.count}}", "b": "0", "o": "number:gt"}]]}
                                                        }
                                                    ]
                                                },
                                                {
                                                    "flow": [
                                                        {
                                                            "id": 17,
                                                            "module": "http:ActionSendData",
                                                            "version": 3,
                                                            "parameters": {},
                                                            "mapper": {
                                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                                "method": "POST",
                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                "bodyType": "raw",
                                                                "contentType": "application/json",
                                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ“¦ Non hai annunci attivi al momento.\\n\\nPer vendere qualcosa, pubblica un post nel gruppo Facebook!\"}}",
                                                                "parseResponse": true
                                                            },
                                                            "metadata": {"designer": {"x": 1500, "y": 250, "notes": {"text": "Nessun annuncio", "position": "bottom"}}}
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 18,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ‘‹ Ciao! Sono l'assistente Quofind.\\n\\nEcco cosa posso fare:\\n\\nğŸ” CERCARE - Scrivi cosa cerchi\\nğŸ“¦ VENDERE - Pubblica nel gruppo FB\\nğŸ’° SALDO - Vedi il tuo cashback\\nğŸ“œ STORICO - Le tue transazioni\\nğŸ“‹ ANNUNCI - I tuoi annunci attivi\\n\\nğŸ’¡ Come funziona il cashback?\\nOgni vendita ti fa guadagnare il 2% del prezzo!\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"ğŸ” Cerca\",\"payload\":\"SEARCH\"},{\"content_type\":\"text\",\"title\":\"ğŸ“¦ I miei annunci\",\"payload\":\"MY_LISTINGS\"},{\"content_type\":\"text\",\"title\":\"ğŸ’° Saldo\",\"payload\":\"BALANCE\"},{\"content_type\":\"text\",\"title\":\"â“ FAQ\",\"payload\":\"FAQ\"}]}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 900,
                                                    "y": 400,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nMENU HELP PRINCIPALE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nMostra tutte le opzioni disponibili con quick replies.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            },
                                            "filter": {
                                                "name": "HELP",
                                                "conditions": [[{"a": "{{1.entry[].messaging[].postback.payload}}", "b": "HELP", "o": "text:equal"}]]
                                            }
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 19,
                                            "module": "util:SetVariables",
                                            "version": 1,
                                            "parameters": {},
                                            "mapper": {"variables": [{"name": "listingId", "value": "{{replace(1.entry[].messaging[].postback.payload; \"CONTACT_\"; \"\")}}"}]},
                                            "metadata": {"designer": {"x": 900, "y": 600, "notes": {"text": "Estrai listing ID", "position": "bottom"}}},
                                            "filter": {
                                                "name": "CONTACT_*",
                                                "conditions": [[{"a": "{{1.entry[].messaging[].postback.payload}}", "b": "CONTACT_", "o": "text:startswith"}]]
                                            }
                                        },
                                        {
                                            "id": 20,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings/{{19.listingId}}",
                                                "method": "GET",
                                                "headers": [],
                                                "parseResponse": true
                                            },
                                            "metadata": {"designer": {"x": 1200, "y": 600, "notes": {"text": "Recupera dettagli listing e seller", "position": "bottom"}}}
                                        },
                                        {
                                            "id": 21,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{20.data.userId}}\"},\"messaging_type\":\"MESSAGE_TAG\",\"tag\":\"CONFIRMED_EVENT_UPDATE\",\"message\":{\"text\":\"ğŸ“© Qualcuno Ã¨ interessato al tuo annuncio!\\n\\nğŸ“¦ {{20.data.title}}\\nğŸ’° {{20.data.price}}â‚¬\\n\\nVuoi essere messo in contatto?\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"âœ… SÃ¬, contattami\",\"payload\":\"ACCEPT_CONTACT_{{1.entry[].messaging[].sender.id}}_{{19.listingId}}\"},{\"content_type\":\"text\",\"title\":\"âŒ No grazie\",\"payload\":\"DECLINE_CONTACT\"}]}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1500,
                                                    "y": 600,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nNOTIFICA VENDITORE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nInforma il venditore che qualcuno Ã¨ interessato.\n\nâš ï¸ TAG: CONFIRMED_EVENT_UPDATE\nPermette di inviare messaggi anche dopo 24h.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 22,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ“¤ Ho contattato il venditore!\\n\\nRiceverai un messaggio quando risponde.\\n\\nğŸ“¦ {{20.data.title}}\\nğŸ’° {{20.data.price}}â‚¬\"}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {"designer": {"x": 1800, "y": 600, "notes": {"text": "Conferma al buyer", "position": "bottom"}}}
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "flow": [
                        {
                            "id": 23,
                            "module": "http:ActionSendData",
                            "version": 3,
                            "parameters": {},
                            "mapper": {
                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/users/{{1.entry[].messaging[].sender.id}}/context",
                                "method": "GET",
                                "headers": [],
                                "parseResponse": true
                            },
                            "metadata": {
                                "designer": {
                                    "x": 600,
                                    "y": 200,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nRECUPERA CONTESTO UTENTE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nControlla se stiamo aspettando un input specifico.\n\nEs: awaitingInput = 'sale_price' â†’ L'utente sta rispondendo con il prezzo di vendita",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "filter": {
                                "name": "Is Text Message",
                                "conditions": [[{"a": "{{1.entry[].messaging[].message.text}}", "b": "", "o": "text:notequal"}]]
                            }
                        },
                        {
                            "id": 24,
                            "module": "builtin:BasicRouter",
                            "version": 1,
                            "parameters": {"else": 1},
                            "mapper": null,
                            "metadata": {
                                "designer": {
                                    "x": 900,
                                    "y": 200,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nROUTER: CONTESTO CONVERSAZIONE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâ†’ ROUTE A: Aspetta prezzo vendita\nâ†’ ROUTE B: Nessun contesto â†’ Gemini intent",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "routes": [
                                {
                                    "flow": [
                                        {
                                            "id": 25,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=YOUR_GEMINI_API_KEY",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"contents\":[{\"parts\":[{\"text\":\"Estrai il prezzo numerico da questo messaggio. Rispondi SOLO con un numero (es: 350), senza simboli o testo.\\n\\nMessaggio: {{1.entry[].messaging[].message.text}}\"}]}],\"generationConfig\":{\"temperature\":0,\"maxOutputTokens\":20}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {"designer": {"x": 1200, "y": 100, "notes": {"text": "Estrai prezzo da messaggio", "position": "bottom"}}},
                                            "filter": {
                                                "name": "Awaiting Sale Price",
                                                "conditions": [[{"a": "{{23.data.awaitingInput}}", "b": "sale_price", "o": "text:equal"}]]
                                            }
                                        },
                                        {
                                            "id": 26,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/payments",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"sellerId\": \"{{1.entry[].messaging[].sender.id}}\", \"facebookPostId\": \"{{23.data.contextData.postId}}\", \"amount\": {{25.data.candidates[].content.parts[].text}}, \"currency\": \"EUR\", \"source\": \"messenger_confirmation\"}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1500,
                                                    "y": 100,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nREGISTRA VENDITA\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nCrea record pagamento/vendita.\nQuesto triggererÃ  lo Scenario 4 per il cashback.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 27,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/users/{{1.entry[].messaging[].sender.id}}/context",
                                                "method": "DELETE",
                                                "headers": [],
                                                "parseResponse": true
                                            },
                                            "metadata": {"designer": {"x": 1800, "y": 100, "notes": {"text": "Pulisci contesto", "position": "bottom"}}}
                                        },
                                        {
                                            "id": 28,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ‰ Vendita registrata!\\n\\nğŸ’° Prezzo: {{25.data.candidates[].content.parts[].text}}â‚¬\\nğŸ’µ Cashback: {{26.data.cashbackAmount}}â‚¬\\n\\nIl cashback sarÃ  disponibile tra 30 giorni.\\n\\nGrazie per aver usato Quofind!\"}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {"designer": {"x": 2100, "y": 100, "notes": {"text": "Conferma vendita + cashback", "position": "bottom"}}}
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 29,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=YOUR_GEMINI_API_KEY",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"contents\":[{\"parts\":[{\"text\":\"Analizza questo messaggio di un utente su un marketplace e determina l'intent.\\n\\nMessaggio: {{1.entry[].messaging[].message.text}}\\n\\nRispondi SOLO con JSON valido:\\n{\\n  \\\"intent\\\": \\\"search\\\" | \\\"balance\\\" | \\\"help\\\" | \\\"greeting\\\" | \\\"thanks\\\" | \\\"complaint\\\" | \\\"other\\\",\\n  \\\"keywords\\\": [\\\"keyword1\\\", \\\"keyword2\\\"],\\n  \\\"category\\\": \\\"categoria\\\" | null,\\n  \\\"maxPrice\\\": numero | null,\\n  \\\"location\\\": \\\"localitÃ \\\" | null,\\n  \\\"sentiment\\\": \\\"positive\\\" | \\\"neutral\\\" | \\\"negative\\\"\\n}\"}]}],\"generationConfig\":{\"temperature\":0.2,\"maxOutputTokens\":300}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1200,
                                                    "y": 300,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nGEMINI: INTENT DETECTION\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nAnalizza il messaggio per capire cosa vuole l'utente.\n\nğŸ¯ INTENTS:\nâ€¢ search â†’ Cerca prodotti\nâ€¢ balance â†’ Chiede saldo\nâ€¢ help â†’ Vuole aiuto\nâ€¢ greeting â†’ Saluto\nâ€¢ thanks â†’ Ringraziamento\nâ€¢ complaint â†’ Lamentela\nâ€¢ other â†’ Altro",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 30,
                                            "module": "json:ParseJSON",
                                            "version": 1,
                                            "parameters": {},
                                            "mapper": {"json": "{{29.data.candidates[].content.parts[].text}}"},
                                            "metadata": {"designer": {"x": 1500, "y": 300, "notes": {"text": "Parse intent JSON", "position": "bottom"}}}
                                        },
                                        {
                                            "id": 31,
                                            "module": "builtin:BasicRouter",
                                            "version": 1,
                                            "parameters": {"else": 0},
                                            "mapper": null,
                                            "metadata": {"designer": {"x": 1800, "y": 300, "notes": {"text": "Router per intent", "position": "bottom"}}},
                                            "routes": [
                                                {
                                                    "flow": [
                                                        {
                                                            "id": 32,
                                                            "module": "http:ActionSendData",
                                                            "version": 3,
                                                            "parameters": {},
                                                            "mapper": {
                                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings?q={{join(30.keywords; \",\")}}&category={{30.category}}&maxPrice={{30.maxPrice}}&location={{30.location}}&limit=10",
                                                                "method": "GET",
                                                                "headers": [],
                                                                "parseResponse": true
                                                            },
                                                            "metadata": {"designer": {"x": 2100, "y": 200, "notes": {"text": "Cerca listing corrispondenti", "position": "bottom"}}},
                                                            "filter": {"name": "search", "conditions": [[{"a": "{{30.intent}}", "b": "search", "o": "text:equal"}]]}
                                                        },
                                                        {
                                                            "id": 33,
                                                            "module": "http:ActionSendData",
                                                            "version": 3,
                                                            "parameters": {},
                                                            "mapper": {
                                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/requests",
                                                                "method": "POST",
                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                "bodyType": "raw",
                                                                "contentType": "application/json",
                                                                "body": "{\"userId\": \"{{1.entry[].messaging[].sender.id}}\", \"keywords\": {{30.keywords}}, \"category\": \"{{30.category}}\", \"maxPrice\": {{30.maxPrice}}, \"location\": \"{{30.location}}\", \"source\": \"messenger\"}",
                                                                "parseResponse": true
                                                            },
                                                            "metadata": {"designer": {"x": 2400, "y": 200, "notes": {"text": "Salva request per matching futuro", "position": "bottom"}}}
                                                        },
                                                        {
                                                            "id": 34,
                                                            "module": "builtin:BasicRouter",
                                                            "version": 1,
                                                            "parameters": {"else": 1},
                                                            "mapper": null,
                                                            "metadata": {"designer": {"x": 2700, "y": 200, "notes": {"text": "Risultati trovati?", "position": "bottom"}}},
                                                            "routes": [
                                                                {
                                                                    "flow": [
                                                                        {
                                                                            "id": 35,
                                                                            "module": "http:ActionSendData",
                                                                            "version": 3,
                                                                            "parameters": {},
                                                                            "mapper": {
                                                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                                                "method": "POST",
                                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                                "bodyType": "raw",
                                                                                "contentType": "application/json",
                                                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ” Ho trovato {{32.data.count}} risultati per la tua ricerca!\"}}",
                                                                                "parseResponse": true
                                                                            },
                                                                            "metadata": {"designer": {"x": 3000, "y": 150}},
                                                                            "filter": {"name": "Has Results", "conditions": [[{"a": "{{32.data.count}}", "b": "0", "o": "number:gt"}]]}
                                                                        },
                                                                        {
                                                                            "id": 36,
                                                                            "module": "http:ActionSendData",
                                                                            "version": 3,
                                                                            "parameters": {},
                                                                            "mapper": {
                                                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                                                "method": "POST",
                                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                                "bodyType": "raw",
                                                                                "contentType": "application/json",
                                                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"attachment\":{\"type\":\"template\",\"payload\":{\"template_type\":\"generic\",\"elements\":{{32.data.carouselElements}}}}}}",
                                                                                "parseResponse": true
                                                                            },
                                                                            "metadata": {"designer": {"x": 3300, "y": 150, "notes": {"text": "Carousel risultati", "position": "bottom"}}}
                                                                        }
                                                                    ]
                                                                },
                                                                {
                                                                    "flow": [
                                                                        {
                                                                            "id": 37,
                                                                            "module": "http:ActionSendData",
                                                                            "version": 3,
                                                                            "parameters": {},
                                                                            "mapper": {
                                                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                                                "method": "POST",
                                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                                "bodyType": "raw",
                                                                                "contentType": "application/json",
                                                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ” Non ho trovato risultati per \\\"{{join(30.keywords; \\\", \\\")}}\\\"\\n\\nHo salvato la tua ricerca e ti avviserÃ² quando arrivano nuovi annunci!\\n\\nğŸ”” Request ID: {{33.data.id}}\"}}",
                                                                                "parseResponse": true
                                                                            },
                                                                            "metadata": {"designer": {"x": 3000, "y": 250, "notes": {"text": "Nessun risultato, ricerca salvata", "position": "bottom"}}}
                                                                        }
                                                                    ]
                                                                }
                                                            ]
                                                        }
                                                    ]
                                                },
                                                {
                                                    "flow": [
                                                        {
                                                            "id": 38,
                                                            "module": "http:ActionSendData",
                                                            "version": 3,
                                                            "parameters": {},
                                                            "mapper": {
                                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                                "method": "POST",
                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                "bodyType": "raw",
                                                                "contentType": "application/json",
                                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].messaging[].sender.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ‘‹ Ciao! Come posso aiutarti oggi?\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"ğŸ” Cerca\",\"payload\":\"SEARCH\"},{\"content_type\":\"text\",\"title\":\"ğŸ’° Saldo\",\"payload\":\"BALANCE\"},{\"content_type\":\"text\",\"title\":\"â“ Aiuto\",\"payload\":\"HELP\"}]}}",
                                                                "parseResponse": true
                                                            },
                                                            "metadata": {"designer": {"x": 2100, "y": 400}},
                                                            "filter": {"name": "greeting", "conditions": [[{"a": "{{30.intent}}", "b": "greeting", "o": "text:equal"}]]}
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        }
    ],
    "metadata": {
        "version": 1,
        "scenario": {
            "roundtrips": 1,
            "maxErrors": 3,
            "autoCommit": true,
            "autoCommitTriggerLast": true,
            "sequential": false
        },
        "designer": {"orphans": []},
        "notes": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nSCENARIO 2: MESSENGER HANDLER\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ“‹ DESCRIZIONE:\nGestisce tutte le interazioni via Facebook Messenger:\n- Messaggi testuali (ricerche, domande)\n- Click su pulsanti (postback)\n- Flussi conversazionali con contesto\n\nğŸ”„ FLUSSO:\n\n1. WEBHOOK riceve messaggio/postback\n   â†“\n2. ROUTER: Postback o Testo?\n   â†“\n3a. POSTBACK â†’ Router payload:\n    â€¢ CONFIRM_* â†’ Crea listing/request\n    â€¢ SOLD_* â†’ Registra vendita\n    â€¢ BALANCE â†’ Mostra saldo\n    â€¢ TRANSACTIONS â†’ Storico\n    â€¢ MY_LISTINGS â†’ Lista annunci\n    â€¢ CONTACT_* â†’ Contatta venditore\n    â€¢ HELP â†’ Menu aiuto\n   â†“\n3b. TESTO â†’ Controlla contesto:\n    â€¢ Ha contesto (es: aspetta prezzo) â†’ Processa\n    â€¢ No contesto â†’ Gemini intent detection\n      â†’ search: Cerca + salva request\n      â†’ greeting: Saluta\n      â†’ altro: Help\n\nâš™ï¸ CONFIGURAZIONI:\nâ€¢ YOUR_GEMINI_API_KEY\nâ€¢ YOUR_PAGE_ACCESS_TOKEN\n\nğŸ”— ENDPOINT AWS USATI:\nâ€¢ GET /cashback/balance\nâ€¢ GET /cashback/transactions\nâ€¢ GET /listings\nâ€¢ POST /requests\nâ€¢ POST /payments\nâ€¢ GET/PUT/DELETE /users/{id}/context\n\nğŸ’¡ CONTESTO CONVERSAZIONALE:\nUsa /users/{id}/context per ricordare cosa stiamo aspettando dall'utente (es: prezzo vendita).\n\nğŸ“Š OPERAZIONI: ~5-15 per messaggio"
    }
}
