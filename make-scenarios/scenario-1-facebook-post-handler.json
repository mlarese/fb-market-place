{
    "name": "Quofind - 1. Handle Facebook Post",
    "flow": [
        {
            "id": 1,
            "module": "gateway:CustomWebHook",
            "version": 1,
            "parameters": {
                "hook": null,
                "maxResults": 1
            },
            "mapper": {},
            "metadata": {
                "designer": {
                    "x": 0,
                    "y": 0,
                    "notes": {
                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nWEBHOOK: FACEBOOK PAGE EVENTS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nRiceve eventi webhook da Facebook quando un utente interagisce con la pagina/gruppo.\n\nğŸ“¥ EVENTI RICEVUTI:\nâ€¢ verb='add' â†’ Nuovo post pubblicato\nâ€¢ verb='edit' â†’ Post modificato\nâ€¢ verb='remove' â†’ Post eliminato\n\nâš™ï¸ CONFIGURAZIONE FACEBOOK:\n1. developers.facebook.com â†’ La tua App\n2. Webhooks â†’ Page â†’ Subscribe\n3. Callback URL: [URL di questo webhook]\n4. Verify Token: quofind_make_2024\n5. Fields: feed, messages\n\nğŸ“¦ STRUTTURA DATI RICEVUTI:\n{\n  \"object\": \"page\",\n  \"entry\": [{\n    \"id\": \"PAGE_ID\",\n    \"time\": 1234567890,\n    \"changes\": [{\n      \"field\": \"feed\",\n      \"value\": {\n        \"item\": \"post\",\n        \"verb\": \"add|edit|remove\",\n        \"post_id\": \"123_456\",\n        \"message\": \"Testo del post...\",\n        \"from\": {\n          \"id\": \"USER_FB_ID\",\n          \"name\": \"Nome Utente\"\n        },\n        \"photos\": [\"url1\", \"url2\"]\n      }\n    }]\n  }]\n}\n\nğŸ”— VARIABILI OUTPUT:\nâ€¢ {{1.object}} â†’ 'page'\nâ€¢ {{1.entry[].id}} â†’ ID pagina\nâ€¢ {{1.entry[].changes[].value.verb}} â†’ Azione\nâ€¢ {{1.entry[].changes[].value.message}} â†’ Testo\nâ€¢ {{1.entry[].changes[].value.from.id}} â†’ User ID\nâ€¢ {{1.entry[].changes[].value.post_id}} â†’ Post ID",
                        "position": "bottom"
                    }
                },
                "restore": {},
                "expect": [
                    {"name": "object", "type": "text"},
                    {
                        "name": "entry",
                        "type": "array",
                        "spec": [
                            {"name": "id", "type": "text"},
                            {"name": "time", "type": "number"},
                            {
                                "name": "changes",
                                "type": "array",
                                "spec": [
                                    {"name": "field", "type": "text"},
                                    {
                                        "name": "value",
                                        "type": "collection",
                                        "spec": [
                                            {"name": "item", "type": "text"},
                                            {"name": "verb", "type": "text"},
                                            {"name": "post_id", "type": "text"},
                                            {"name": "message", "type": "text"},
                                            {"name": "photos", "type": "array", "spec": [{"name": "url", "type": "text"}]},
                                            {
                                                "name": "from",
                                                "type": "collection",
                                                "spec": [
                                                    {"name": "id", "type": "text"},
                                                    {"name": "name", "type": "text"}
                                                ]
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        },
        {
            "id": 2,
            "module": "builtin:BasicRouter",
            "version": 1,
            "parameters": {"else": 0},
            "mapper": null,
            "metadata": {
                "designer": {
                    "x": 300,
                    "y": 0,
                    "notes": {
                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nROUTER: SMISTAMENTO EVENTI FACEBOOK\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nIndirizza il flusso in base al tipo di azione sul post.\n\nğŸ”€ ROUTES CONFIGURATE:\n\nâ†’ ROUTE 1 (SOPRA): NUOVO POST\n  Filtro: verb = 'add'\n  Flusso: Gemini â†’ Parse â†’ Crea Listing/Request â†’ Notifica\n\nâ†’ ROUTE 2 (CENTRO): POST MODIFICATO\n  Filtro: verb = 'edit'\n  Flusso: Gemini â†’ Parse â†’ Aggiorna Listing/Request â†’ Notifica\n\nâ†’ ROUTE 3 (SOTTO): POST ELIMINATO\n  Filtro: verb = 'remove'\n  Flusso: Elimina da DB â†’ Notifica\n\nâš ï¸ IMPORTANTE:\nOgni route ha un FILTRO che determina quando viene eseguita.\nSe nessun filtro corrisponde, il flusso si ferma qui.",
                        "position": "bottom"
                    }
                }
            },
            "routes": [
                {
                    "flow": [
                        {
                            "id": 3,
                            "module": "http:ActionSendData",
                            "version": 3,
                            "parameters": {},
                            "mapper": {
                                "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=YOUR_GEMINI_API_KEY",
                                "method": "POST",
                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                "qs": [],
                                "bodyType": "raw",
                                "contentType": "application/json",
                                "body": "{\"contents\":[{\"parts\":[{\"text\":\"Sei un assistente per un marketplace italiano. Analizza questo post Facebook e classifica se Ã¨ un ANNUNCIO DI VENDITA (listing), una RICHIESTA DI ACQUISTO (request), o ALTRO (other).\\n\\nPOST DA ANALIZZARE:\\n{{1.entry[].changes[].value.message}}\\n\\nRispondi SOLO con un JSON valido (NO markdown, NO ```json), con questa struttura ESATTA:\\n{\\n  \\\"type\\\": \\\"listing\\\" oppure \\\"request\\\" oppure \\\"other\\\",\\n  \\\"confidence\\\": numero da 0 a 1,\\n  \\\"title\\\": \\\"titolo breve e descrittivo\\\",\\n  \\\"description\\\": \\\"descrizione completa dell'articolo o richiesta\\\",\\n  \\\"category\\\": \\\"elettronica\\\" oppure \\\"abbigliamento\\\" oppure \\\"casa\\\" oppure \\\"auto\\\" oppure \\\"sport\\\" oppure \\\"libri\\\" oppure \\\"giochi\\\" oppure \\\"altro\\\",\\n  \\\"price\\\": numero oppure null se non specificato,\\n  \\\"currency\\\": \\\"EUR\\\",\\n  \\\"location\\\": \\\"cittÃ  o zona geografica\\\" oppure null,\\n  \\\"keywords\\\": [\\\"keyword1\\\", \\\"keyword2\\\", \\\"keyword3\\\"],\\n  \\\"condition\\\": \\\"nuovo\\\" oppure \\\"usato\\\" oppure \\\"ricondizionato\\\" oppure null,\\n  \\\"negotiable\\\": true oppure false,\\n  \\\"urgency\\\": \\\"alta\\\" oppure \\\"media\\\" oppure \\\"bassa\\\" oppure null\\n}\\n\\nREGOLE:\\n- Se il post Ã¨ un annuncio di vendita â†’ type: \\\"listing\\\"\\n- Se il post cerca qualcosa da comprare â†’ type: \\\"request\\\"\\n- Se non Ã¨ nÃ© vendita nÃ© ricerca â†’ type: \\\"other\\\"\\n- Estrai il prezzo se menzionato (es: \\\"500 euro\\\" â†’ price: 500)\\n- Estrai la localitÃ  se menzionata\\n- Genera keywords utili per la ricerca\\n- confidence indica quanto sei sicuro della classificazione\"}]}],\"generationConfig\":{\"temperature\":0.2,\"maxOutputTokens\":800,\"topP\":0.8}}",
                                "parseResponse": true
                            },
                            "metadata": {
                                "designer": {
                                    "x": 600,
                                    "y": -300,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nGEMINI AI: ANALISI NUOVO POST\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nInvia il testo del post a Google Gemini per analisi semantica.\n\nâš ï¸ CONFIGURAZIONE OBBLIGATORIA:\nSostituisci YOUR_GEMINI_API_KEY nell'URL!\nOttieni la key da: https://aistudio.google.com/app/apikey\n\nğŸ¤– COSA FA L'AI:\n1. Legge il testo del post Facebook\n2. Classifica: listing (vendita) / request (ricerca) / other\n3. Estrae informazioni strutturate:\n   - Titolo sintetico\n   - Descrizione completa\n   - Categoria merceologica\n   - Prezzo e valuta\n   - LocalitÃ \n   - Keywords per ricerca\n   - Condizione (nuovo/usato)\n   - Se prezzo trattabile\n   - Livello urgenza\n4. Assegna confidence score\n\nğŸ“¤ PARAMETRI GEMINI:\nâ€¢ model: gemini-1.5-flash (veloce, economico)\nâ€¢ temperature: 0.2 (output deterministico)\nâ€¢ maxOutputTokens: 800\nâ€¢ topP: 0.8\n\nğŸ’° COSTI:\n~$0.00015 per richiesta (molto economico)\n~1000 richieste = $0.15\n\nğŸ“¦ OUTPUT:\n{{3.data.candidates[].content.parts[].text}}\nâ†’ Stringa JSON da parsare nel modulo successivo\n\nâŒ ERRORI POSSIBILI:\nâ€¢ 400: API key invalida\nâ€¢ 429: Rate limit (300 req/min free tier)\nâ€¢ 500: Errore Gemini",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "filter": {
                                "name": "Is New Post (verb=add)",
                                "conditions": [[{"a": "{{1.entry[].changes[].value.verb}}", "b": "add", "o": "text:equal"}]]
                            }
                        },
                        {
                            "id": 4,
                            "module": "json:ParseJSON",
                            "version": 1,
                            "parameters": {},
                            "mapper": {
                                "json": "{{3.data.candidates[].content.parts[].text}}"
                            },
                            "metadata": {
                                "designer": {
                                    "x": 900,
                                    "y": -300,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nJSON PARSER: RISPOSTA GEMINI\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nConverte la stringa JSON di Gemini in un oggetto strutturato.\n\nğŸ“¥ INPUT:\n{{3.data.candidates[].content.parts[].text}}\n\nEsempio risposta Gemini:\n{\n  \"type\": \"listing\",\n  \"confidence\": 0.95,\n  \"title\": \"iPhone 13 Pro 256GB\",\n  \"description\": \"Vendo iPhone 13 Pro...\",\n  \"category\": \"elettronica\",\n  \"price\": 650,\n  \"currency\": \"EUR\",\n  \"location\": \"Milano\",\n  \"keywords\": [\"iphone\", \"apple\", \"smartphone\"],\n  \"condition\": \"usato\",\n  \"negotiable\": true,\n  \"urgency\": \"media\"\n}\n\nğŸ“¤ OUTPUT - Variabili disponibili:\nâ€¢ {{4.type}} â†’ 'listing' | 'request' | 'other'\nâ€¢ {{4.confidence}} â†’ 0.0 - 1.0\nâ€¢ {{4.title}} â†’ Titolo estratto\nâ€¢ {{4.description}} â†’ Descrizione\nâ€¢ {{4.category}} â†’ Categoria\nâ€¢ {{4.price}} â†’ Prezzo numerico o null\nâ€¢ {{4.currency}} â†’ 'EUR'\nâ€¢ {{4.location}} â†’ LocalitÃ  o null\nâ€¢ {{4.keywords}} â†’ Array keywords\nâ€¢ {{4.condition}} â†’ Condizione o null\nâ€¢ {{4.negotiable}} â†’ true/false\nâ€¢ {{4.urgency}} â†’ Urgenza o null\n\nâŒ ERRORI:\nSe Gemini restituisce JSON malformato, questo modulo FALLISCE.\nConsiglio: aggiungi Error Handler â†’ Ignora e continua",
                                        "position": "bottom"
                                    }
                                }
                            }
                        },
                        {
                            "id": 5,
                            "module": "builtin:BasicRouter",
                            "version": 1,
                            "parameters": {"else": 0},
                            "mapper": null,
                            "metadata": {
                                "designer": {
                                    "x": 1200,
                                    "y": -300,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nROUTER: TIPO CONTENUTO\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nSmista in base al tipo identificato da Gemini.\n\nğŸ”€ ROUTES:\n\nâ†’ ROUTE A: LISTING (Annuncio vendita)\n  Filtro: type='listing' AND confidence>=0.7\n  Azione: Crea listing nel database\n\nâ†’ ROUTE B: REQUEST (Richiesta acquisto)\n  Filtro: type='request' AND confidence>=0.7\n  Azione: Crea request + trigger matching\n\nâ†’ ROUTE C: LOW CONFIDENCE\n  Filtro: confidence<0.7\n  Azione: Chiedi conferma all'utente\n\nâ†’ ROUTE D: OTHER (default)\n  Nessuna azione (post ignorato)\n\nğŸ’¡ SOGLIA CONFIDENCE:\n0.7 = 70% sicurezza minima per procedere\nSotto questa soglia, meglio chiedere conferma.",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "routes": [
                                {
                                    "flow": [
                                        {
                                            "id": 6,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "qs": [],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"userId\": \"{{1.entry[].changes[].value.from.id}}\", \"userName\": \"{{1.entry[].changes[].value.from.name}}\", \"facebookPostId\": \"{{1.entry[].changes[].value.post_id}}\", \"title\": \"{{4.title}}\", \"description\": \"{{4.description}}\", \"category\": \"{{4.category}}\", \"price\": {{4.price}}, \"currency\": \"{{4.currency}}\", \"location\": \"{{4.location}}\", \"keywords\": {{4.keywords}}, \"condition\": \"{{4.condition}}\", \"negotiable\": {{4.negotiable}}, \"urgency\": \"{{4.urgency}}\", \"source\": \"facebook_post\", \"aiConfidence\": {{4.confidence}}, \"originalMessage\": \"{{1.entry[].changes[].value.message}}\", \"photos\": {{1.entry[].changes[].value.photos}}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1500,
                                                    "y": -450,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nCREA LISTING SU AWS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nSalva l'annuncio di vendita nel database DynamoDB via Lambda.\n\nğŸ”— ENDPOINT:\nPOST https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings\n\nğŸ“¤ DATI INVIATI:\n{\n  \"userId\": \"FB_USER_ID\",\n  \"userName\": \"Nome Utente\",\n  \"facebookPostId\": \"123_456\",\n  \"title\": \"iPhone 13 Pro\",\n  \"description\": \"Vendo iPhone...\",\n  \"category\": \"elettronica\",\n  \"price\": 650,\n  \"currency\": \"EUR\",\n  \"location\": \"Milano\",\n  \"keywords\": [\"iphone\", \"apple\"],\n  \"condition\": \"usato\",\n  \"negotiable\": true,\n  \"urgency\": \"media\",\n  \"source\": \"facebook_post\",\n  \"aiConfidence\": 0.95,\n  \"originalMessage\": \"Testo originale...\",\n  \"photos\": [\"url1\", \"url2\"]\n}\n\nğŸ“¥ RISPOSTA:\n{\n  \"success\": true,\n  \"data\": {\n    \"id\": \"lst_abc123\",\n    \"createdAt\": \"2024-01-15T10:30:00Z\",\n    \"expiresAt\": \"2024-02-14T10:30:00Z\"\n  }\n}\n\nğŸ”— VARIABILI OUTPUT:\nâ€¢ {{6.data.id}} â†’ ID listing creato\nâ€¢ {{6.data.createdAt}} â†’ Data creazione\nâ€¢ {{6.data.expiresAt}} â†’ Scadenza (30gg)\n\nâŒ ERRORI:\nâ€¢ 400: Dati mancanti/invalidi\nâ€¢ 409: Listing giÃ  esiste (stesso post_id)\nâ€¢ 500: Errore database",
                                                        "position": "bottom"
                                                    }
                                                }
                                            },
                                            "filter": {
                                                "name": "Is Listing + High Confidence",
                                                "conditions": [
                                                    [
                                                        {"a": "{{4.type}}", "b": "listing", "o": "text:equal"},
                                                        {"a": "{{4.confidence}}", "b": "0.7", "o": "number:gte"}
                                                    ]
                                                ]
                                            }
                                        },
                                        {
                                            "id": 7,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "qs": [],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].changes[].value.from.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"âœ… Annuncio creato con successo!\\n\\nğŸ“¦ {{4.title}}\\nğŸ’° {{4.price}}â‚¬{{if(4.negotiable; \\\" (trattabile)\\\"; \\\"\\\")}}\\nğŸ“ {{4.location}}\\nğŸ·ï¸ {{4.category}}\\n\\nID: {{6.data.id}}\\n\\nIl tuo annuncio Ã¨ ora visibile nel marketplace e sarÃ  attivo per 30 giorni.\\n\\nQuando vendi, riceverai cashback!\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"ğŸ“‹ I miei annunci\",\"payload\":\"MY_LISTINGS\"},{\"content_type\":\"text\",\"title\":\"ğŸ’° Saldo cashback\",\"payload\":\"BALANCE\"},{\"content_type\":\"text\",\"title\":\"â“ Aiuto\",\"payload\":\"HELP\"}]}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1800,
                                                    "y": -450,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nMESSENGER: CONFERMA LISTING CREATO\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nInvia messaggio di conferma all'utente via Facebook Messenger.\n\nâš ï¸ CONFIGURAZIONE:\nSostituisci YOUR_PAGE_ACCESS_TOKEN!\nOttienilo da: Facebook Developer â†’ Tua App â†’ Messenger â†’ Page Access Token\n\nğŸ“¤ MESSAGGIO INVIATO:\n\"âœ… Annuncio creato con successo!\n\nğŸ“¦ [Titolo]\nğŸ’° [Prezzo]â‚¬ (trattabile)\nğŸ“ [LocalitÃ ]\nğŸ·ï¸ [Categoria]\n\nID: [listing_id]\n\nIl tuo annuncio Ã¨ ora visibile...\"\n\nğŸ”˜ QUICK REPLIES:\nâ€¢ ğŸ“‹ I miei annunci â†’ MY_LISTINGS\nâ€¢ ğŸ’° Saldo cashback â†’ BALANCE\nâ€¢ â“ Aiuto â†’ HELP\n\nğŸ’¡ QUICK REPLIES:\nPulsanti cliccabili che facilitano la navigazione.\nQuando l'utente clicca, il payload viene inviato allo Scenario 2 (Messenger Handler).\n\nâŒ ERRORI:\nâ€¢ 400: Token invalido\nâ€¢ 10: Utente non ha mai interagito con la pagina\nâ€¢ 551: Utente ha bloccato i messaggi",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 8,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/requests",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "qs": [],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"userId\": \"{{1.entry[].changes[].value.from.id}}\", \"userName\": \"{{1.entry[].changes[].value.from.name}}\", \"facebookPostId\": \"{{1.entry[].changes[].value.post_id}}\", \"title\": \"{{4.title}}\", \"description\": \"{{4.description}}\", \"category\": \"{{4.category}}\", \"maxPrice\": {{4.price}}, \"currency\": \"{{4.currency}}\", \"location\": \"{{4.location}}\", \"keywords\": {{4.keywords}}, \"condition\": \"{{4.condition}}\", \"urgency\": \"{{4.urgency}}\", \"source\": \"facebook_post\", \"aiConfidence\": {{4.confidence}}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1500,
                                                    "y": -150,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nCREA REQUEST SU AWS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nSalva la richiesta di acquisto nel database.\n\nğŸ”— ENDPOINT:\nPOST /requests\n\nğŸ“¤ DATI:\nâ€¢ maxPrice invece di price (budget massimo)\nâ€¢ keywords per matching automatico\nâ€¢ urgency per prioritÃ  matching\n\nğŸ“¥ RISPOSTA:\n{{8.data.id}} â†’ ID request creata\n\nğŸ’¡ MATCHING:\nLo Scenario 3 (Periodic Matching) cercherÃ  automaticamente listing corrispondenti ogni 5 minuti.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            },
                                            "filter": {
                                                "name": "Is Request + High Confidence",
                                                "conditions": [
                                                    [
                                                        {"a": "{{4.type}}", "b": "request", "o": "text:equal"},
                                                        {"a": "{{4.confidence}}", "b": "0.7", "o": "number:gte"}
                                                    ]
                                                ]
                                            }
                                        },
                                        {
                                            "id": 9,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/internal/matching",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "qs": [],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"requestId\": \"{{8.data.id}}\", \"immediate\": true}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1800,
                                                    "y": -150,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nTRIGGER MATCHING IMMEDIATO\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nAvvia subito il matching per questa nuova request.\n\nğŸ”— ENDPOINT:\nPOST /internal/matching\n\nğŸ“¤ BODY:\nâ€¢ requestId: ID della request appena creata\nâ€¢ immediate: true (esegui subito)\n\nğŸ’¡ PERCHÃ‰:\nNon aspettare lo scheduler ogni 5 min.\nL'utente vuole risultati immediati.\n\nğŸ“¥ RISPOSTA:\n{{9.data.matches}} â†’ Array di listing corrispondenti\n{{9.data.count}} â†’ Numero di match trovati",
                                                        "position": "bottom"
                                                    }
                                                }
                                            }
                                        },
                                        {
                                            "id": 10,
                                            "module": "builtin:BasicRouter",
                                            "version": 1,
                                            "parameters": {"else": 0},
                                            "mapper": null,
                                            "metadata": {
                                                "designer": {
                                                    "x": 2100,
                                                    "y": -150,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nROUTER: RISULTATI MATCHING\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nâ†’ ROUTE A: Match trovati\n  Filtro: count > 0\n  Azione: Invia carousel risultati\n\nâ†’ ROUTE B: Nessun match\n  Filtro: count = 0\n  Azione: Messaggio \"ti avviseremo\"",
                                                        "position": "bottom"
                                                    }
                                                }
                                            },
                                            "routes": [
                                                {
                                                    "flow": [
                                                        {
                                                            "id": 11,
                                                            "module": "http:ActionSendData",
                                                            "version": 3,
                                                            "parameters": {},
                                                            "mapper": {
                                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                                "method": "POST",
                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                "qs": [],
                                                                "bodyType": "raw",
                                                                "contentType": "application/json",
                                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].changes[].value.from.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"attachment\":{\"type\":\"template\",\"payload\":{\"template_type\":\"generic\",\"elements\":{{9.data.matches}}}}}}",
                                                                "parseResponse": true
                                                            },
                                                            "metadata": {
                                                                "designer": {
                                                                    "x": 2400,
                                                                    "y": -250,
                                                                    "notes": {
                                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nMESSENGER: CAROUSEL RISULTATI\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nInvia i risultati del matching come carousel interattivo.\n\nğŸ“¤ FORMATO CAROUSEL:\nâ€¢ Fino a 10 elementi\nâ€¢ Ogni elemento: immagine, titolo, sottotitolo, pulsanti\nâ€¢ Pulsanti: Contatta, Dettagli, Nascondi\n\nğŸ’¡ L'array {{9.data.matches}} deve essere giÃ  formattato come elementi carousel dalla Lambda.",
                                                                        "position": "bottom"
                                                                    }
                                                                }
                                                            },
                                                            "filter": {
                                                                "name": "Has Matches",
                                                                "conditions": [[{"a": "{{9.data.count}}", "b": "0", "o": "number:gt"}]]
                                                            }
                                                        }
                                                    ]
                                                },
                                                {
                                                    "flow": [
                                                        {
                                                            "id": 12,
                                                            "module": "http:ActionSendData",
                                                            "version": 3,
                                                            "parameters": {},
                                                            "mapper": {
                                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                                "method": "POST",
                                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                                "qs": [],
                                                                "bodyType": "raw",
                                                                "contentType": "application/json",
                                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].changes[].value.from.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ” Richiesta registrata!\\n\\nCerchi: {{4.title}}\\nğŸ’° Budget: {{if(4.price; concat(\\\"fino a \\\"; 4.price; \\\"â‚¬\\\"); \\\"non specificato\\\")}}\\nğŸ“ Zona: {{if(4.location; 4.location; \\\"qualsiasi\\\")}}\\n\\nAl momento non ci sono annunci corrispondenti, ma ti avviseremo appena ne arrivano!\\n\\nğŸ”” Riceverai una notifica quando troviamo qualcosa per te.\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"ğŸ” Cerca altro\",\"payload\":\"SEARCH\"},{\"content_type\":\"text\",\"title\":\"ğŸ“‹ Le mie ricerche\",\"payload\":\"MY_REQUESTS\"},{\"content_type\":\"text\",\"title\":\"â“ Aiuto\",\"payload\":\"HELP\"}]}}",
                                                                "parseResponse": true
                                                            },
                                                            "metadata": {
                                                                "designer": {
                                                                    "x": 2400,
                                                                    "y": -50,
                                                                    "notes": {
                                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nMESSENGER: NESSUN RISULTATO\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nInforma l'utente che la ricerca Ã¨ stata salvata.\n\nğŸ“¤ MESSAGGIO:\n\"ğŸ” Richiesta registrata!\n\nCerchi: [titolo]\nBudget: [prezzo]\nZona: [localitÃ ]\n\nAl momento non ci sono annunci corrispondenti, ma ti avviseremo appena ne arrivano!\"\n\nğŸ’¡ La request rimane attiva per 7 giorni.\nLo Scenario 3 controllerÃ  ogni 5 minuti.",
                                                                        "position": "bottom"
                                                                    }
                                                                }
                                                            },
                                                            "filter": {
                                                                "name": "No Matches",
                                                                "conditions": [[{"a": "{{9.data.count}}", "b": "0", "o": "number:equal"}]]
                                                            }
                                                        }
                                                    ]
                                                }
                                            ]
                                        }
                                    ]
                                },
                                {
                                    "flow": [
                                        {
                                            "id": 13,
                                            "module": "http:ActionSendData",
                                            "version": 3,
                                            "parameters": {},
                                            "mapper": {
                                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                                "method": "POST",
                                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                                "qs": [],
                                                "bodyType": "raw",
                                                "contentType": "application/json",
                                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].changes[].value.from.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ¤” Non sono sicuro di aver capito bene il tuo post.\\n\\nÃˆ un annuncio di vendita o stai cercando qualcosa?\\n\\nSeleziona un'opzione:\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"ğŸ“¦ Sto vendendo\",\"payload\":\"CONFIRM_LISTING_{{1.entry[].changes[].value.post_id}}\"},{\"content_type\":\"text\",\"title\":\"ğŸ” Sto cercando\",\"payload\":\"CONFIRM_REQUEST_{{1.entry[].changes[].value.post_id}}\"},{\"content_type\":\"text\",\"title\":\"âŒ Ignora\",\"payload\":\"IGNORE_{{1.entry[].changes[].value.post_id}}\"}]}}",
                                                "parseResponse": true
                                            },
                                            "metadata": {
                                                "designer": {
                                                    "x": 1500,
                                                    "y": 150,
                                                    "notes": {
                                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nMESSENGER: CHIEDI CONFERMA (LOW CONFIDENCE)\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nSe Gemini non Ã¨ sicuro (confidence < 0.7), chiedi all'utente.\n\nğŸ“¤ MESSAGGIO:\n\"ğŸ¤” Non sono sicuro di aver capito bene...\nÃˆ un annuncio di vendita o stai cercando?\"\n\nğŸ”˜ QUICK REPLIES:\nâ€¢ ğŸ“¦ Sto vendendo â†’ CONFIRM_LISTING_[post_id]\nâ€¢ ğŸ” Sto cercando â†’ CONFIRM_REQUEST_[post_id]\nâ€¢ âŒ Ignora â†’ IGNORE_[post_id]\n\nğŸ’¡ I payload includono il post_id per permettere allo Scenario 2 di processare la conferma dell'utente.",
                                                        "position": "bottom"
                                                    }
                                                }
                                            },
                                            "filter": {
                                                "name": "Low Confidence (<0.7)",
                                                "conditions": [[{"a": "{{4.confidence}}", "b": "0.7", "o": "number:lt"}]]
                                            }
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                },
                {
                    "flow": [
                        {
                            "id": 14,
                            "module": "http:ActionSendData",
                            "version": 3,
                            "parameters": {},
                            "mapper": {
                                "url": "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=YOUR_GEMINI_API_KEY",
                                "method": "POST",
                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                "qs": [],
                                "bodyType": "raw",
                                "contentType": "application/json",
                                "body": "{\"contents\":[{\"parts\":[{\"text\":\"Analizza questo post Facebook MODIFICATO e restituisci i dati aggiornati.\\n\\nPOST MODIFICATO:\\n{{1.entry[].changes[].value.message}}\\n\\nRispondi SOLO con JSON valido (stesso formato di prima).\"}]}],\"generationConfig\":{\"temperature\":0.2,\"maxOutputTokens\":800}}",
                                "parseResponse": true
                            },
                            "metadata": {
                                "designer": {
                                    "x": 600,
                                    "y": 0,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nGEMINI AI: ANALISI POST MODIFICATO\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nRi-analizza il post modificato per estrarre i nuovi dati.\n\nğŸ’¡ QUANDO SCATTA:\nQuando verb = 'edit' (utente ha modificato il post)\n\nPuÃ² cambiare:\nâ€¢ Prezzo aggiornato\nâ€¢ Descrizione modificata\nâ€¢ Aggiunta/rimozione foto\n\nIl flusso poi aggiornerÃ  il listing/request esistente.",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "filter": {
                                "name": "Is Edit (verb=edit)",
                                "conditions": [[{"a": "{{1.entry[].changes[].value.verb}}", "b": "edit", "o": "text:equal"}]]
                            }
                        },
                        {
                            "id": 15,
                            "module": "json:ParseJSON",
                            "version": 1,
                            "parameters": {},
                            "mapper": {"json": "{{14.data.candidates[].content.parts[].text}}"},
                            "metadata": {
                                "designer": {
                                    "x": 900,
                                    "y": 0,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nJSON PARSER: DATI AGGIORNATI\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nStesso parsing del modulo 4.\nOutput in {{15.xxx}}",
                                        "position": "bottom"
                                    }
                                }
                            }
                        },
                        {
                            "id": 16,
                            "module": "http:ActionSendData",
                            "version": 3,
                            "parameters": {},
                            "mapper": {
                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings/by-post/{{1.entry[].changes[].value.post_id}}",
                                "method": "PUT",
                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                "qs": [],
                                "bodyType": "raw",
                                "contentType": "application/json",
                                "body": "{\"title\": \"{{15.title}}\", \"description\": \"{{15.description}}\", \"price\": {{15.price}}, \"location\": \"{{15.location}}\", \"keywords\": {{15.keywords}}, \"condition\": \"{{15.condition}}\", \"negotiable\": {{15.negotiable}}, \"updatedAt\": \"{{now}}\"}",
                                "parseResponse": true
                            },
                            "metadata": {
                                "designer": {
                                    "x": 1200,
                                    "y": 0,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nAGGIORNA LISTING/REQUEST\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ”— ENDPOINT:\nPUT /listings/by-post/{post_id}\n\nCerca il listing tramite facebookPostId e lo aggiorna con i nuovi dati.\n\nğŸ’¡ Se il listing non esiste (post originale non era stato processato), l'API restituisce 404 e il flusso si ferma qui (non Ã¨ un errore critico).",
                                        "position": "bottom"
                                    }
                                }
                            }
                        },
                        {
                            "id": 17,
                            "module": "http:ActionSendData",
                            "version": 3,
                            "parameters": {},
                            "mapper": {
                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                "method": "POST",
                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                "qs": [],
                                "bodyType": "raw",
                                "contentType": "application/json",
                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].changes[].value.from.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"âœï¸ Annuncio aggiornato!\\n\\n{{15.title}}\\nğŸ’° {{15.price}}â‚¬\\n\\nLe modifiche sono ora visibili nel marketplace.\"}}",
                                "parseResponse": true
                            },
                            "metadata": {
                                "designer": {
                                    "x": 1500,
                                    "y": 0,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nMESSENGER: CONFERMA AGGIORNAMENTO\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nNotifica l'utente che il suo annuncio Ã¨ stato aggiornato.",
                                        "position": "bottom"
                                    }
                                }
                            }
                        }
                    ]
                },
                {
                    "flow": [
                        {
                            "id": 18,
                            "module": "http:ActionSendData",
                            "version": 3,
                            "parameters": {},
                            "mapper": {
                                "url": "https://3nw6p7c866.execute-api.eu-west-1.amazonaws.com/dev/listings/by-post/{{1.entry[].changes[].value.post_id}}",
                                "method": "DELETE",
                                "headers": [],
                                "qs": [],
                                "parseResponse": true
                            },
                            "metadata": {
                                "designer": {
                                    "x": 600,
                                    "y": 300,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nELIMINA LISTING DA AWS\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nQuando l'utente elimina il post Facebook, rimuove automaticamente l'annuncio dal database.\n\nğŸ”— ENDPOINT:\nDELETE /listings/by-post/{post_id}\n\nğŸ’¡ SINCRONIZZAZIONE:\nPost eliminato su FB â†’ Listing eliminato dal marketplace\n\nSe il listing non esisteva â†’ 404 (ignorato)\nSe esisteva â†’ 200 + listing eliminato\n\nâš ï¸ NOTA:\nElimina anche eventuali request associate allo stesso post_id.",
                                        "position": "bottom"
                                    }
                                }
                            },
                            "filter": {
                                "name": "Is Delete (verb=remove)",
                                "conditions": [[{"a": "{{1.entry[].changes[].value.verb}}", "b": "remove", "o": "text:equal"}]]
                            }
                        },
                        {
                            "id": 19,
                            "module": "http:ActionSendData",
                            "version": 3,
                            "parameters": {},
                            "mapper": {
                                "url": "https://graph.facebook.com/v18.0/me/messages?access_token=YOUR_PAGE_ACCESS_TOKEN",
                                "method": "POST",
                                "headers": [{"name": "Content-Type", "value": "application/json"}],
                                "qs": [],
                                "bodyType": "raw",
                                "contentType": "application/json",
                                "body": "{\"recipient\":{\"id\":\"{{1.entry[].changes[].value.from.id}}\"},\"messaging_type\":\"RESPONSE\",\"message\":{\"text\":\"ğŸ—‘ï¸ Annuncio rimosso dal marketplace.\\n\\nSe hai venduto l'oggetto e vuoi registrare la vendita per il cashback, rispondi con:\\n\\\"Venduto a [prezzo]â‚¬\\\"\",\"quick_replies\":[{\"content_type\":\"text\",\"title\":\"âœ… Ho venduto\",\"payload\":\"SOLD_{{1.entry[].changes[].value.post_id}}\"},{\"content_type\":\"text\",\"title\":\"ğŸ“¦ Nuovo annuncio\",\"payload\":\"NEW_LISTING\"},{\"content_type\":\"text\",\"title\":\"ğŸ’° Saldo\",\"payload\":\"BALANCE\"}]}}",
                                "parseResponse": true
                            },
                            "metadata": {
                                "designer": {
                                    "x": 900,
                                    "y": 300,
                                    "notes": {
                                        "text": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nMESSENGER: CONFERMA ELIMINAZIONE\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nNotifica l'utente e chiede se ha venduto.\n\nğŸ“¤ MESSAGGIO:\n\"ğŸ—‘ï¸ Annuncio rimosso...\nSe hai venduto, rispondi 'Venduto a [prezzo]â‚¬'\"\n\nğŸ”˜ QUICK REPLIES:\nâ€¢ âœ… Ho venduto â†’ SOLD_[post_id]\nâ€¢ ğŸ“¦ Nuovo annuncio â†’ NEW_LISTING\nâ€¢ ğŸ’° Saldo â†’ BALANCE\n\nğŸ’¡ Se l'utente conferma la vendita, lo Scenario 2 processerÃ  il payload SOLD_xxx e avvierÃ  il flusso cashback.",
                                        "position": "bottom"
                                    }
                                }
                            }
                        }
                    ]
                }
            ]
        }
    ],
    "metadata": {
        "version": 1,
        "scenario": {
            "roundtrips": 1,
            "maxErrors": 3,
            "autoCommit": true,
            "autoCommitTriggerLast": true,
            "sequential": false,
            "confidential": false,
            "dataloss": false,
            "dlq": false
        },
        "designer": {
            "orphans": []
        },
        "notes": "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\nSCENARIO 1: HANDLE FACEBOOK POST\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\nğŸ“‹ DESCRIZIONE:\nIntercetta tutti i post pubblicati nei gruppi/pagine Facebook collegati e li processa automaticamente:\n- Nuovi post â†’ Analisi AI â†’ Creazione listing/request\n- Post modificati â†’ Aggiornamento dati\n- Post eliminati â†’ Rimozione dal database\n\nğŸ”„ FLUSSO COMPLETO:\n\n1. WEBHOOK riceve evento da Facebook\n   â†“\n2. ROUTER smista per tipo (add/edit/remove)\n   â†“\n3a. ADD â†’ Gemini analizza â†’ Router tipo:\n    â€¢ Listing (vendita) â†’ Crea su DB â†’ Notifica\n    â€¢ Request (ricerca) â†’ Crea + Matching immediato â†’ Notifica\n    â€¢ Low confidence â†’ Chiedi conferma utente\n   â†“\n3b. EDIT â†’ Ri-analizza â†’ Aggiorna DB â†’ Notifica\n   â†“\n3c. REMOVE â†’ Elimina da DB â†’ Chiedi se venduto\n\nâš™ï¸ CONFIGURAZIONI RICHIESTE:\n\n1. YOUR_GEMINI_API_KEY\n   â†’ https://aistudio.google.com/app/apikey\n\n2. YOUR_PAGE_ACCESS_TOKEN\n   â†’ Facebook Developer â†’ App â†’ Messenger Settings\n\n3. Webhook URL su Facebook\n   â†’ L'URL di questo scenario\n\nğŸ“Š OPERAZIONI MAKE STIMATE:\nâ€¢ Nuovo post: ~6-8 operazioni\nâ€¢ Post modificato: ~4 operazioni\nâ€¢ Post eliminato: ~3 operazioni\n\nğŸ’° COSTI STIMATI (1000 post/mese):\nâ€¢ Make: ~7000 operazioni (piano Pro consigliato)\nâ€¢ Gemini: ~$0.15\nâ€¢ AWS: ~$1-2 (Free Tier copre molto)\n\nğŸ”— SCENARI COLLEGATI:\nâ€¢ Scenario 2: Gestisce risposte utente (CONFIRM_*, SOLD_*, etc.)\nâ€¢ Scenario 3: Matching periodico per request\nâ€¢ Scenario 4: Cashback quando venduto\n\nğŸ› DEBUG:\nâ€¢ History â†’ Click su esecuzione â†’ Espandi moduli\nâ€¢ Controlla {{x.data}} per vedere risposte API\nâ€¢ Errori comuni: token scaduti, API key invalide"
    }
}
